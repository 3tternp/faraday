"""Vulnerability merge model

Revision ID: 526aa91cac98
Revises: 2db31733fb78
Create Date: 2019-07-01 19:19:10.166057+00:00

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = '526aa91cac98'
down_revision = '59bed5515407'
branch_labels = None
depends_on = None

#TODO Verificar que se borran las fk

def upgrade():
    op.create_table(
        'knowledge_base',
        sa.Column('id', sa.Integer, primary_key=True),
        sa.Column('vulnerability_template_id', sa.Integer),
        sa.Column('identifier', sa.Text),
        sa.Column('shipped', sa.Boolean),
        )

    op.create_foreign_key(
        'knowledge_base_vulnerability_template_id_fkey',
        'knowledge_base',
        'vulnerability_template', ['vulnerability_template_id'], ['id']

    )

    op.add_column('vulnerability',
        sa.Column(
            'association_date',
            sa.DateTime(),
            nullable=True
        )
    )

    op.add_column('vulnerability',
        sa.Column(
            'vulnerability_template_id',
            sa.Integer(),
            nullable=True
        )
    )

    op.create_foreign_key(
        'vulnerability_vulnerability_template_id_fkey',
        'vulnerability',
        'vulnerability_template', ['vulnerability_template_id'], ['id']
    )

    op.add_column('vulnerability',
        sa.Column(
            'vulnerability_duplicate_id',
            sa.Integer(),
            nullable=True
        )
    )

    op.create_foreign_key(
        'vulnerability_vulnerability_duplicate_id_fkey',
        'vulnerability',
        'vulnerability', ['vulnerability_duplicate_id'], ['id']
    )


def downgrade():
    op.drop_table('knowledge_base')

    op.drop_column('vulnerability','vulnerability_duplicate_id')
    op.drop_column('vulnerability','vulnerability_template_id')
    op.drop_column('vulnerability','association_date')
